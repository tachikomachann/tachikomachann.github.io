<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.8.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"tachikomachann.github.io","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Less is more">
<meta property="og:type" content="website">
<meta property="og:title" content="タチコマの部屋">
<meta property="og:url" content="https://tachikomachann.github.io/page/2/index.html">
<meta property="og:site_name" content="タチコマの部屋">
<meta property="og:description" content="Less is more">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="タチコマの部屋">
<meta name="twitter:description" content="Less is more">

<link rel="canonical" href="https://tachikomachann.github.io/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-Hans'
  };
</script>

  <title>タチコマの部屋</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">タチコマの部屋</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://tachikomachann.github.io/2018/10/21/Java中的CAS与ABA问题/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Tachikoma">
      <meta itemprop="description" content="Less is more">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="タチコマの部屋">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/10/21/Java中的CAS与ABA问题/" class="post-title-link" itemprop="url">Java中的CAS与ABA问题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-10-21 20:01:00" itemprop="dateCreated datePublished" datetime="2018-10-21T20:01:00+08:00">2018-10-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-11-28 17:20:52" itemprop="dateModified" datetime="2020-11-28T17:20:52+08:00">2020-11-28</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>今天面试别人的时候，提到了CAS，本来想要引导他说出CAS潜在的ABA问题，发现自己也没发简单的向他解释清楚,需要好好梳理下。</p>
<h2 id="什么是-CAS"><a href="#什么是-CAS" class="headerlink" title="什么是 CAS"></a>什么是 CAS</h2><p>维基百科的解释是：</p>
<blockquote>
<p>In computer science, compare-and-swap (CAS) is an atomic instruction used in multithreading to achieve synchronization. It compares the contents of a memory location with a given value and, only if they are the same, modifies the contents of that memory location to a new given value. This is done as a single atomic operation. The atomicity guarantees that the new value is calculated based on up-to-date information; if the value had been updated by another thread in the meantime, the write would fail. The result of the operation must indicate whether it performed the substitution; this can be done either with a simple boolean response (this variant is often called compare-and-set), or by returning the value read from the memory location (not the value written to it).</p>
</blockquote>
<p>CAS(compare and swap)，简单地说就是一种在多线程的情况下，让每个线程修改某个数据是一种原子操作。要实现CAS，有几个关键的值：</p>
<ol>
<li>要修改的变量内存中的值V</li>
<li>更新变量前事先记录的期望值E，取值来自V</li>
<li>将要更新的值A</li>
</ol>
<p>一个典型的CAS更新操作如下：</p>
<ol>
<li>读取内存中的值V，赋值给E</li>
<li>更新变量前，比较内存值V与E</li>
<li>如果V==E,将V更新成A</li>
<li>如果V!=E，重复步骤1</li>
</ol>
<p>如此循环，直到步骤3更新操作完成，写成伪代码就是：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span>&#123;</span><br><span class="line">    <span class="keyword">int</span> e=v.getVal();</span><br><span class="line">    <span class="keyword">synchronized</span>(<span class="keyword">this</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(e==getVal())&#123;</span><br><span class="line">            v.setVal(a);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">while</span>(<span class="keyword">true</span>)</span><br></pre></td></tr></table></figure>
<p>CAS在JDK中被广泛应用，比如java.util.concurrent包下面的Lock、AtomicInteger相关的类都有用到。<br>例如<code>a++;</code>这种操作在Java里面并不是原子操作（包含了值的累加和赋值两个动作），所以并发情况下竞争操作某一个变量，需要用AtomicXXX几个类。</p>
<h3 id="举个例子"><a href="#举个例子" class="headerlink" title="举个例子"></a>举个例子</h3><p>AtomicInteger 实现类似<code>a++</code>操作，使用的是它的<code>incrementAndGet</code> 方法，源码很简单：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Atomically increments by one the current value.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the updated value</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">incrementAndGet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        <span class="keyword">int</span> current = get();</span><br><span class="line">        <span class="keyword">int</span> next = current + <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// 此处的 compareAndSet 由usafe对象提供硬件级别的原子操作</span></span><br><span class="line">        <span class="keyword">if</span> (compareAndSet(current, next))</span><br><span class="line">            <span class="keyword">return</span> next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Lock中对于竞争变量的CAS，也是类似的操作。</p>
<h2 id="什么是ABA问题"><a href="#什么是ABA问题" class="headerlink" title="什么是ABA问题"></a>什么是ABA问题</h2><p>简单地说就是，多个线程同时使用CAS更新数据时：</p>
<ol>
<li>线程1要将数据从A变成B时（此时线程1的期待值E==’A’）</li>
<li>其他线程已经抢先更新了变量，把变量从A变成其他值，再变回A（如A-&gt;C-&gt;A）。</li>
<li>当线程1用CAS机制准备更新变量时，发现E==A，所以继续更新变量。</li>
</ol>
<h3 id="这样有什么问题？"><a href="#这样有什么问题？" class="headerlink" title="这样有什么问题？"></a>这样有什么问题？</h3><p>虽然变量最终结果是对的，但是线程1更新变量前，变量已经经历了一系列变化才回到原值。对于某些场景，忽略变化会继续进行更新操作，会带来错误的结果。<br>比如：</p>
<h4 id="银行账户扣费问题"><a href="#银行账户扣费问题" class="headerlink" title="银行账户扣费问题"></a>银行账户扣费问题</h4><p>某个银行账户扣款操作，由于系统故障，产生了2个线程（T1,T2）对同一账户进行扣款，正常防重逻辑应该是一个执行成功，另一个失败，但是如果使用上面的CAS操作，就是：</p>
<ol>
<li>账户里有100元，需要扣款50元</li>
<li>T1先完成操作，扣款50元，将账户值V改为50</li>
<li>T2准备扣款，当时期待值E==100</li>
<li>此时有其他转账操作先于T2对V进行累加，比如转入50元，此时V又变成100</li>
<li>T2进行CAS的更新操作，发现E\==V\==100,执行更新操作，<strong>又扣款50</strong></li>
</ol>
<h4 id="堆栈操作问题"><a href="#堆栈操作问题" class="headerlink" title="堆栈操作问题"></a>堆栈操作问题</h4><p>如果CAS中的操作，变量值V是栈顶指针，也会有同样的问题：</p>
<ol>
<li>某个堆栈内容是：A-B-C,栈顶为A</li>
<li>线程1更新前，得到期望值E==A</li>
<li>其他线程对栈进行进行pop,push操作，pop A B,push D A,此时栈的内容为 A-D-C</li>
<li>此时栈顶还是A，但是内容已经改变，线程1要更新的堆栈，已经不是第2步拿到期望值E时，自己要操作的那个堆栈了</li>
</ol>
<h3 id="如何规避"><a href="#如何规避" class="headerlink" title="如何规避"></a>如何规避</h3><p>思路也很简单，就是对得到的期望值E和变量值V，增加一个版本号（比如时间戳），对于不同时期操作产生的同一个值的V，版本号是不同的，比较E与V时，需要同时比较版本号。比如juc包的<code>AtomicStampedReference</code>实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AtomicStampedReference</span>&lt;<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Pair</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> T reference;  <span class="comment">//维护对象引用</span></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> stamp;  <span class="comment">//用于标志版本</span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="title">Pair</span><span class="params">(T reference, <span class="keyword">int</span> stamp)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.reference = reference;</span><br><span class="line">            <span class="keyword">this</span>.stamp = stamp;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">static</span> &lt;T&gt; <span class="function">Pair&lt;T&gt; <span class="title">of</span><span class="params">(T reference, <span class="keyword">int</span> stamp)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Pair&lt;T&gt;(reference, stamp);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> Pair&lt;V&gt; pair;</span><br><span class="line">    ....</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">      * expectedReference ：更新之前的原始值</span></span><br><span class="line"><span class="comment">      * newReference : 将要更新的新值</span></span><br><span class="line"><span class="comment">      * expectedStamp : 期待更新的标志版本</span></span><br><span class="line"><span class="comment">      * newStamp : 将要更新的标志版本</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">compareAndSet</span><span class="params">(V   expectedReference,</span></span></span><br><span class="line"><span class="function"><span class="params">                                 V   newReference,</span></span></span><br><span class="line"><span class="function"><span class="params">                                 <span class="keyword">int</span> expectedStamp,</span></span></span><br><span class="line"><span class="function"><span class="params">                                 <span class="keyword">int</span> newStamp)</span> </span>&#123;</span><br><span class="line">        Pair&lt;V&gt; current = pair; <span class="comment">//获取当前pair</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">            expectedReference == current.reference &amp;&amp; <span class="comment">//原始值等于当前pair的值引用，说明值未变化</span></span><br><span class="line">            expectedStamp == current.stamp &amp;&amp; <span class="comment">// 原始标记版本等于当前pair的标记版本，说明标记未变化</span></span><br><span class="line">            ((newReference == current.reference &amp;&amp;</span><br><span class="line">              newStamp == current.stamp) || <span class="comment">// 将要更新的值和标记都没有变化</span></span><br><span class="line">             casPair(current, Pair.of(newReference, newStamp))); <span class="comment">// cas 更新pair</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol>
<li>CAS 是一种自旋锁，由一个死循环+compareAndSet 实现。</li>
<li>CAS 存在ABA隐患，对于需要关注竞争变量变化过程（不仅仅是变量的值）的场景，ABA问题必须关注。</li>
<li>解决ABA问题，需要在CAS的compare过程中，增加对期望值E和当前值V版本号的判断。</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://tachikomachann.github.io/2018/10/05/2018-10西安游/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Tachikoma">
      <meta itemprop="description" content="Less is more">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="タチコマの部屋">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/10/05/2018-10西安游/" class="post-title-link" itemprop="url">黄金周西安游</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-10-05 19:20:00" itemprop="dateCreated datePublished" datetime="2018-10-05T19:20:00+08:00">2018-10-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-11-28 17:20:52" itemprop="dateModified" datetime="2020-11-28T17:20:52+08:00">2020-11-28</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>9月底突发奇想地想国庆和老婆来西安玩一次，于是就匆匆忙忙订了机票和住宿，提前请了2天假29号飞到了西安。28晚上自己刚从北京出差回来，简直马不停蹄。从29号启程到4号回家，我们看了长恨歌演出，逛了西安城区、华山、陕西历史博物馆、华清池、兵马俑、西安城墙。一路上吃吃喝喝，除了在兵马俑见识了千分之一的中国人口以外，其他时候体验不算太差。整座西安城给人一种浓厚的历史氛围和民族融合带来的活力，让沿海长大的我倍感新奇。</p>
<h2 id="衣"><a href="#衣" class="headerlink" title="衣"></a>衣</h2><p>9月底10月初的西安，让我一个南方人感受到了秋天。一天气温十几度到二十几度，早晚偏冷，白天晒着太阳也不会满头大汗，真正的秋高气爽。所以每天出门我总是穿着一件薄长袖和夹克外套，热了就把外套脱下别在腰上。值得一提的是，西安城内经常能见到穿着汉服的姑娘小伙，也许是这座城市的道路和建筑本身古色古香，不想在其他地方，走在街上看着他们，竟然不觉得突兀，反而别有一番风味，有种“这果然是长安啊”的感叹。</p>
<h2 id="食"><a href="#食" class="headerlink" title="食"></a>食</h2><p>西安的吃，只要吃得惯的话，简直不要太棒。<br>6天时间内，我们逛遍了回民街永兴坊，这里的吃的价格也不算便宜，但是分量够大，随便一份面食都是一大碗，我跟老婆为了多尝几口，总是要两人吃一份。第一天老婆同学请吃羊肉泡馍，见识了如何自助徒手撕膜，撕了半个小时手都麻了，煮上羊肉粉丝汤，满满的一大海碗，吃完都快扶着墙出。路边烤羊肉串一串10块，羊肉又大又肥。面馆里的水盆羊肉、biangbiang面、油泼面……每一个都在让我跟米饭说再见。肉夹馍每家卖的都不大一样，什么都能夹，简直西安汉堡。还有永兴坊的子长煎饼，长得跟广东肠粉一样，吃一份得排半小时队。路边随处可见的石榴汁，小镜糕，大甄糕，酸梅汤，花椒酸奶（真加花椒。。），油茶（这个怂了喝不惯），凉粉，酱牛肉，卤羊蹄，羊杂汤……几天下来，自己的味蕾仿佛打开了一个新世界。</p>
<h2 id="住"><a href="#住" class="headerlink" title="住"></a>住</h2><p>由于我们住的酒店离西安城中心挺近的，我们一有空就往钟楼附近跑。钟楼算是西安城区的中心，再加上周围14公里的西安城墙，整个城内古色古香，建筑风格很有特色，满眼望去都是中国传统的中间高两边低的那种屋顶，这种我以前只在电视剧和故宫里看到。路也很宽，在市内骑自行车很舒服，道路横平竖直，房子坐落得也很规整，整个城市颜色跟中国大多数内陆城市一样，整体偏灰色调。虽然国庆路上人多，地上也不见什么垃圾。不知道是不是来的这几天天气好，空气虽然干燥，但是空气还算清新，蓝天白云的天空配合飒爽的秋意给人感觉很好。</p>
<h2 id="行"><a href="#行" class="headerlink" title="行"></a>行</h2><p>这几天出门一般都是打的外加摩拜，出租车司机师傅跟大多数北方司机一样，喜欢唠嗑，平易近人。西安城区的街道方方正正，看好地图的话，骑车走路都不容易迷路（当然回民街还是要多走几次才懂）。比较痛苦的是去周边景区的大巴车，去华山、兵马俑、华清池我们都报的是一日团，一大早就要坐车出发，路上快则两个小时，堵车就要三四个小时，体验不是很好，特别是从兵马俑回来的时候，我们晚上6点返程，回来已经9点半了。</p>
<h2 id="玩"><a href="#玩" class="headerlink" title="玩"></a>玩</h2><p>这次行程也算比较紧，第一晚我们去华清池看了长恨歌演出，华山、陕西历史博物馆、兵马俑华清池我们各花了一天时间，最后一天逛了西安城墙，然后在几个晚上陆续逛了钟楼附近和回民街永兴坊，大雁塔之类的景点就没再去了。</p>
<p>长恨歌演出门票260多块钱，需要坐车到华清池景区看（后来想想应该在参观兵马俑华清宫的那天晚上来看比较节省时间）。第一次看这种现场的真人歌舞剧表演，比较新鲜，有种春晚现场的感觉，大体上就是用现代声光电技术演了一出杨贵妃唐玄宗的爱情故事，后面还有鹊桥相会啥的（能把一个公公儿媳扒灰的故事写的如此美好也是囧。。）。可惜我艺术功底不够深刻，只能跟周围的大叔大妈看个新鲜。</p>
<p>第二天一大早坐大巴来登华山，两人比较怂，选择了缆车路线，西峰上北峰下，5个小时爬了华山西峰南峰。一整块花岗岩形成的华山，挺拔陡峭，地势险峻，山上很多台阶不到半个脚宽。站在华山上，俯瞰山下，真的会让人感叹祖国大好河山，雄伟瑰丽。可惜最近上班忽略了身体锻炼，西峰爬了不到一半就气喘吁吁，追不上老婆的步伐。看来回去还是要好好锻炼，有生之年要从山底下上一次，来东峰看日出。</p>
<p>第三天鉴于前一天爬华山太累，就选择了市内的陕西历史博物馆，还好提前订了30块钱的大唐珍宝馆门票，免去了排长队进馆的痛苦。陕博不愧为中国博物馆的Top，文物之多，时间跨度之长令人叹为观止。</p>
<p>第四天我们又跟了一日团参观了华清池和兵马俑，这一天算是体验最差的一天。华清池参观什么呢，就是看看以前杨贵妃杨玄宗洗澡的澡堂子，还有西安事变老蒋被抓之前的故居，都是历史遗迹，想要知道以前的情景，只能对着景观配合导游解说发挥想象力了。下午的兵马俑参观让我体验了什么是“世界第一大坑”。据说当天下午兵马俑的客流量达到了15万，从进博物馆大门到走到展馆门口，浩浩荡荡都是人头，排队的时候前胸贴后背，整个人被后面推着走。要进一号坑之前更是痛苦，博物馆方管理太混乱，三队人马三个方向进一个门，其中不乏插队的低素质游客，大家互不相让，差点爆发肢体冲突。进坑之后人山人海，根本看不到前面，人在队伍中，不由自主地被后面人推着走，还没仔细看完兵马俑的细节，就被推着到出口了。</p>
<p>第五天西安城墙游算是最满意的一天，跟老婆吃完一顿早午饭，慢慢悠悠地买上一张上城墙的票，租上一辆双人自行车，开始休闲游。中午到下午这段时间城墙上人不多，西安城墙虽然不是水泥路，但是一路上没有什么坡度，也足够宽敞，3个小时车程下来，轻轻松松绕城墙骑行了一圈半，两边都是充满古城特色的房子和风景，伴着凉爽的秋意，一扫前几天旅行的疲惫。</p>
<h2 id="写在旅行结束后"><a href="#写在旅行结束后" class="headerlink" title="写在旅行结束后"></a>写在旅行结束后</h2><p>最后坐飞机回来前，老婆问我，西安比起以前去过的重庆和成都怎么样？我觉得除了兵马俑那天的大坑以外，西安还是让我非常喜欢的。较慢的生活节奏，好吃的各种美食，浓厚的历史底蕴，人们美好的精神面貌。甚至我都觉得，下半辈子我们应该好好锻炼身体，攒钱来西安置业养老（笑）。人生不应该只有生活工作的那三点一线，应该多一点不一样的经历。相信有生之年，我还会再来几次。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://tachikomachann.github.io/2017/06/01/ThinkPad-x240-使用Manjaro小记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Tachikoma">
      <meta itemprop="description" content="Less is more">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="タチコマの部屋">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/06/01/ThinkPad-x240-使用Manjaro小记/" class="post-title-link" itemprop="url">ThinkPad-x240-使用Manjaro小记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-06-01 19:01:25" itemprop="dateCreated datePublished" datetime="2017-06-01T19:01:25+08:00">2017-06-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-11-28 17:20:52" itemprop="dateModified" datetime="2020-11-28T17:20:52+08:00">2020-11-28</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>最近淘了一部二手x240,换了SSD和高分屏，装上manjaro 17 作为开发备用机，期间遇到了许多坑，在这边同一记录。</p>
<p>原先使用了KDE桌面，后面发现性能还是跟不上，换成了更轻量级的xfce，All is well~</p>
<h2 id="制作U盘启动"><a href="#制作U盘启动" class="headerlink" title="制作U盘启动"></a>制作U盘启动</h2><p>下载 rufus 制作u盘启动</p>
<h2 id="使用U盘安装，启动后显示“failed-to-load-ldlinux-c32”"><a href="#使用U盘安装，启动后显示“failed-to-load-ldlinux-c32”" class="headerlink" title="使用U盘安装，启动后显示“failed to load ldlinux.c32”"></a>使用U盘安装，启动后显示“failed to load ldlinux.c32”</h2><p>传统BIOS与UEFI启动的问题，在BIOS的启动选项里，将启动方式改为<strong>UEFI优先即可</strong>。</p>
<h2 id="更换和添加源"><a href="#更换和添加源" class="headerlink" title="更换和添加源"></a>更换和添加源</h2><pre><code>sudo nano /etc/pacman.d/mirrors/China
</code></pre><p>manjaro 17 中 China 文件已经内置了中国的源，建议把清华的源镜像放在第一位</p>
<pre><code>sudo nano /etc/pacman.d/mirrorlist
</code></pre><p>建议把清华的源镜像放在第一位，更新列表和系统的时候速度会快</p>
<pre><code>sudo nano /etc/pacman-mirrors.conf
</code></pre><p>修改 <code>OnlyCountry = China</code> （注意把前面的注释 # 删掉）</p>
<p>保存退出 ### 添加archlinuxcn</p>
<pre><code>sudo nano /etc/pacman.conf
</code></pre><p>添加</p>
<pre><code>[archlinuxcn]
SigLevel = Optional TrustedOnly
Server= https://mirrors.tuna.tsinghua.edu.cn/archlinuxcn/$arch 
#Server = https://mirrors.6.tuna.tsinghua.edu.cn/archlinuxcn/$arch
# only IPv6#Server = https://mirrors.4.tuna.tsinghua.edu.cn/archlinuxcn/$arch
# only IPv4#HTTP is also supported
</code></pre><p><code>sudo pacman -Syy</code> 更新一下源列表，此处若出现错误，请按照终端提示，删除一个文件 （本机是类似于/var/lib*的一个db文件）</p>
<pre><code># 更新出现以下错误，只要把提示的文件删除即可
libglvnd: 文件系统中已存在 /usr/lib/libEGL.so.1  
libglvnd: 文件系统中已存在 /usr/lib/libEGL.so.1.0.0  
libglvnd: 文件系统中已存在 /usr/lib/libGL.so  
libglvnd: 文件系统中已存在 /usr/lib/libGL.so.1  
libglvnd: 文件系统中已存在 /usr/lib/libGLESv1_CM.so  
libglvnd: 文件系统中已存在 /usr/lib/libGLESv1_CM.so.1  
libglvnd: 文件系统中已存在 /usr/lib/libGLESv2.so  
libglvnd: 文件系统中已存在 /usr/lib/libGLESv2.so.2  
libglvnd: 文件系统中已存在 /usr/lib/libGLESv2.so.2.0.0  
lib32-libglvnd: 文件系统中已存在 /usr/lib32/libEGL.so  
lib32-libglvnd: 文件系统中已存在 /usr/lib32/libEGL.so.1  
lib32-libglvnd: 文件系统中已存在 /usr/lib32/libEGL.so.1.0.0  
lib32-libglvnd: 文件系统中已存在 /usr/lib32/libGL.so  
lib32-libglvnd: 文件系统中已存在 /usr/lib32/libGL.so.1  
lib32-libglvnd: 文件系统中已存在 /usr/lib32/libGLESv1_CM.so  
lib32-libglvnd: 文件系统中已存在 /usr/lib32/libGLESv1_CM.so.1  
lib32-libglvnd: 文件系统中已存在 /usr/lib32/libGLESv2.so  
lib32-libglvnd: 文件系统中已存在 /usr/lib32/libGLESv2.so.2  
lib32-libglvnd: 文件系统中已存在 /usr/lib32/libGLESv2.so.2.0.0
</code></pre><p>重新执行 <code>sudo pacman -Syy</code> 就没有问题了</p>
<p><code></code>sudo pacman -S archlinuxcn-keyring` 此步很关键，是安装archlinuxcn的GPG keys 滚动升级一下系统和软件(不建议频繁滚动升级，稳定为主)</p>
<pre><code>sudo pacman -Syyu
</code></pre><p>开始更新系统了</p>
<h2 id="安装-vi"><a href="#安装-vi" class="headerlink" title="安装 vi"></a>安装 vi</h2><pre><code>pacman -Syy vi
</code></pre><h2 id="安装-aur客户端"><a href="#安装-aur客户端" class="headerlink" title="安装 aur客户端"></a>安装 aur客户端</h2><p><a href="https://www.linuxdashen.com/arch-linux%E4%BD%BF%E7%94%A8yaourt%E5%8C%85%E7%AE%A1%E7%90%86%E5%99%A8%E8%BD%BB%E6%9D%BE%E5%AE%89%E8%A3%85aur%E8%BD%AF%E4%BB%B6%E5%8C%85" target="_blank" rel="noopener">yaourt安装与使用</a> 用yaourt装东西，每次sudo yaourt -S xxx 最后出现</p>
<pre><code>错误： 不能使用 root 用户运行 makepkg， 
因为可能会系统造成灾难性的损坏。 
无法读取 PKGBUILD
</code></pre><p>原因： 不能用 sudo 运行 yaourt ,换句话说必须在普通用户下运行 yaourt yaourt 停止维护了，可以改用yay <code>sudo pacman -Syy yay</code></p>
<h2 id="让终端走代理"><a href="#让终端走代理" class="headerlink" title="让终端走代理"></a>让终端走代理</h2><p>安装并运行 privoxy 或者 polipo, 把本地ss代理转换成http代理，然后把终端代理设置到http代理上：</p>
<pre><code>export https_proxy=http://localhost:8123
export http_proxy=http://localhost:8123
</code></pre><p>终端打开的程序就会走代理了。</p>
<h2 id="安装-搜狗输入法"><a href="#安装-搜狗输入法" class="headerlink" title="安装 搜狗输入法"></a>安装 搜狗输入法</h2><pre><code>sudo pacman -S fcitx-sogoupinyin
sudo pacman -S fcitx-im # 全部安装
sudo pacman -S fcitx-configtool # 图形化配置工具
</code></pre><p>之后就是还需要更改 ~/.xprofile</p>
<pre><code>export GTK_IM_MODULE=fcitx
export QT_IM_MODULE=fcitx
export XMODIFIERS=&quot;@im=fcitx&quot;
</code></pre><p>最后在命令行输入fcitx就可以使用了 </p>
<h3 id="安装日语输入法"><a href="#安装日语输入法" class="headerlink" title="安装日语输入法"></a>安装日语输入法</h3><pre><code>yay -Syy fcitx-anthy
</code></pre><h2 id="dock-软件"><a href="#dock-软件" class="headerlink" title="dock 软件"></a>dock 软件</h2><p><code>aur docky</code></p>
<h2 id="高分屏像素缩放"><a href="#高分屏像素缩放" class="headerlink" title="高分屏像素缩放"></a>高分屏像素缩放</h2><p>系统设置-字体-固定字体dpi 110, 不使用缩放，很多软件在开启缩放后会模糊或其他问题。固定字体的dpi就可以达到缩放效果了。</p>
<h2 id="合上盖子，按电源键挂起没有效果"><a href="#合上盖子，按电源键挂起没有效果" class="headerlink" title="合上盖子，按电源键挂起没有效果"></a>合上盖子，按电源键挂起没有效果</h2><p>经过测试，发现按电源键没产生 acpi 事件，因此不能触发电源管理，此暂不能解决。曲线救国：用fn+f9作为快捷键挂起计算机。</p>
<h2 id="指纹模块"><a href="#指纹模块" class="headerlink" title="指纹模块"></a>指纹模块</h2><p>参考： <a href="https://wiki.archlinux.org/index.php/Fingerprint-gui" target="_blank" rel="noopener">https://wiki.archlinux.org/index.php/Fingerprint-gui</a> 配置完成后su和sudo要求输入密码时，就可以用刷指纹了。 ### 运行fingerprint-gui时出现 could not open fingerprint device permission problem 是因为普通用户没有指纹设备的读写权限。 lsusb 找到指纹模块的 Bus号和Device号，比如：</p>
<pre><code>Bus 002 Device 002: ID 138a:0017 Validity Sensors, Inc. Fingerprint Reader
</code></pre><p>然后赋予<code>/dev/bus/usb/xxx/yyy</code> 777权限 xxx表示Bus号，yyy表示Device号，上面的例子就是 <code>/dev/bus/usb/002/002</code> <a href="http://home.ullrich-online.cc/fingerprint/Forum/topic.php?TopicId=20" target="_blank" rel="noopener">http://home.ullrich-online.cc/fingerprint/Forum/topic.php?TopicId=20</a></p>
<h2 id="KDE-登录界面无法使用指纹识别登录"><a href="#KDE-登录界面无法使用指纹识别登录" class="headerlink" title="KDE 登录界面无法使用指纹识别登录"></a>KDE 登录界面无法使用指纹识别登录</h2><p>fingerprint与kde的kdm不兼容，暂时无解。</p>
<h2 id="IDEA-某些菜单乱码"><a href="#IDEA-某些菜单乱码" class="headerlink" title="IDEA 某些菜单乱码"></a>IDEA 某些菜单乱码</h2><p><a href="http://www.cnblogs.com/lemonbar/p/3924305.html" target="_blank" rel="noopener">http://www.cnblogs.com/lemonbar/p/3924305.html</a></p>
<h2 id="触摸板"><a href="#触摸板" class="headerlink" title="触摸板"></a>触摸板</h2><p><strong>触摸板优化只在 KDE 环境下配置成功过，xfce下不行。</strong></p>
<h3 id="鼠标点击模拟”-下面的选项是无效"><a href="#鼠标点击模拟”-下面的选项是无效" class="headerlink" title="鼠标点击模拟” 下面的选项是无效"></a>鼠标点击模拟” 下面的选项是无效</h3><p>触摸板设置中，“鼠标点击模拟” 下面的选项是灰色的，导致触摸板双指点击作为右键的功能不能用。 </p>
<p>解决方案 ： pacman 安装驱动 重启即可 触摸板驱动：xf86-input-libinput<br>官方从17年1月开始换成 libinput驱动，xf86-input-synaptics进入低维护状态，尽量不用</p>
<p>具体参考  <a href="https://wiki.archlinux.org/index.php/Lenovo_ThinkPad_X240#Touchpad" target="_blank" rel="noopener">https://wiki.archlinux.org/index.php/Lenovo_ThinkPad_X240#Touchpad touchpad</a>  一节</p>
<p>触摸板鼠标手势 安装 <a href="https://github.com/bulletmark/libinput-gestures" target="_blank" rel="noopener">libinput-gestures</a><br>参考 <a href="http://www.cnblogs.com/xiaozhang9/p/6157934.html" target="_blank" rel="noopener">http://www.cnblogs.com/xiaozhang9/p/6157934.html</a></p>
<p>自定义配置文件（x240 最多支持3点触控） <code>~/.config/libinput-gestures.conf</code></p>
<pre><code>gesture swipe left 4 xdotool key super+Left # 4指左划: 切换到左侧工作区 
gesture swipe right 4 xdotool key super+Right # 4指右划: 切换到右侧工作区 

gesture swipe left 3 xdotool key alt+Left # 3指左划: 网页后退 
gesture swipe right 3 xdotool key alt+Right # 3指右划: 网页前进 
gesture swipe up 3 xdotool key super+w  # 3指上划: 显示当前桌面所有窗口 
gesture swipe down 3 xdotool key super+d # 3指下划: 显示桌面 

gesture pinch in 2 xdotool key ctrl+minus # 2指捏: 缩小 
gesture pinch out 2 xdotool key ctrl+plus # 2指张: 放大
</code></pre><p>保存配置文件 然后启动 <code>libinput-gestures-setup start</code> 也可以重启 <code>libinput-gestures-setup restart</code> 加入开机启动 <code>libinput-gestures-setup autostart</code></p>
<h2 id="取消自动锁屏（KDE）"><a href="#取消自动锁屏（KDE）" class="headerlink" title="取消自动锁屏（KDE）"></a>取消自动锁屏（KDE）</h2><p>系统设置–桌面行为–锁屏 中设置</p>
<h2 id="没有ifconfig命令"><a href="#没有ifconfig命令" class="headerlink" title="没有ifconfig命令"></a>没有ifconfig命令</h2><p>安装net-tool</p>
<pre><code>pacman -S net-tools dnsutils inetutils iproute2
</code></pre><p>##共享鼠标键盘软件 synergy 下载地址 <a href="http://www.afzaalace.com/synergy-stable-builds/" target="_blank" rel="noopener">http://www.afzaalace.com/synergy-stable-builds/</a><br>arch 可以直接用pacman下载</p>
<p>Synergy分为服务端和客户端，用户使用鼠标键盘的那一台机子是服务端，其他的是客户端 Arch下的服务端配置 <code>/etc/synergy.conf</code></p>
<pre><code># screens 指的是操作的电脑的名字， 
section: screens  
       caixx-pc:  
       Eternity-Home:  
end  
# 配置各电脑之间的相对位置 
section: links  
       caixx-pc:  
               left = Eternity-Home  

       Eternity-Home:  
               right  = caixx-pc  

end  
# 电脑别名 
section: aliases  
       caixx-pc:  
               192.168.1.103  
       Eternity-Home:  
               192.168.1.105  
end
</code></pre><p>配置完后运行服务端 <code>synergys -f</code><br>运行客户端 <code>synergyc -f 服务端ip地址</code></p>
<h2 id="xfce-桌面相关"><a href="#xfce-桌面相关" class="headerlink" title="xfce 桌面相关"></a>xfce 桌面相关</h2><p>主题： aur paper-gtk-theme-git<br>aur paper-icon-theme-git aur paper-icon-theme</p>
<p>ctrl键交换 修改 ~/.profile 增加 /usr/bin/setxkbmap -option “ctrl:swapcaps”</p>
<p>一些快捷键命令： </p>
<p>睡眠 xfce4-session-logout –suspend</p>
<p>休眠 xfce4-session-logout –hibernate<br>弹出开始菜单 xfce4-popup-whiskermenu</p>
<p>锁屏 xflock4 </p>
<p>哪里设置快捷键？ 全局快捷键： setting –&gt; keyboard –&gt; Application shortcuts 窗口相关快捷键：setting –&gt; windows manager</p>
<p>打开docky有，屏幕中间有一条线： image.png-276.2kB 设置-窗口管理器微调-合成器-去掉勾选“在dock窗口下显示阴影”</p>
<p>锁定屏幕后一段时间再用电脑，出现黑屏，只看到鼠标： 关闭屏保试试: 在设置种的 电源管理器 里关闭所有会关闭屏幕的选项 aur light-locker-settings 在设置里关闭 light-locker</p>
<p>滚动背景窗口时，不改变窗口焦点</p>
<p>Settings —&gt; Window Manager Tweaks —&gt; Accessibility 取消‘raise windows when any mouse button is pressed’ 选项</p>
<p><img src="Untitled-4b6c7e42-d2be-4469-a01f-03cc6f642bc5.png" alt></p>
<h2 id="Arch-上维护的常用程序列表-wiki"><a href="#Arch-上维护的常用程序列表-wiki" class="headerlink" title="Arch 上维护的常用程序列表 wiki"></a>Arch 上维护的常用程序列表 wiki</h2><p>常用的程序都可以在上面找到： <a href="https://wiki.archlinux.org/index.php/List_of_applications_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87" target="_blank" rel="noopener">https://wiki.archlinux.org/index.php/List_of_applications_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)</a>)</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://tachikomachann.github.io/2016/11/08/第N次开博客/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Tachikoma">
      <meta itemprop="description" content="Less is more">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="タチコマの部屋">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/11/08/第N次开博客/" class="post-title-link" itemprop="url">第N次开博客</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-11-08 18:35:18" itemprop="dateCreated datePublished" datetime="2016-11-08T18:35:18+08:00">2016-11-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-11-28 17:20:52" itemprop="dateModified" datetime="2020-11-28T17:20:52+08:00">2020-11-28</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>也不知道这是第几次搭博客了，新浪博客、QQ空间、百度空间、CSDN、ITEYE、OSChina、自建博客……折腾博客的经历几乎跟自己的网龄一样长。写博文这件事，也没有一直坚持下来。所以，为什么这次又开了一个博客？自己总结了以下几点：</p>
<p>我的工作生活，需要一个宣泄的地方。<br>想要再锻炼一下自己写技术博客的能力。<br>很不习惯熟人看到我写的东西，不会再暴露任何个人信息了。<br>年纪一大，不想再折腾，免费博客服务是我的首选。<br>So，这次直接选了hexo，再尝试一次，看看自己能做到哪一步吧。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Tachikoma</p>
  <div class="site-description" itemprop="description">Less is more</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">14</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Tachikoma</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script>



  















  

  

</body>
</html>
