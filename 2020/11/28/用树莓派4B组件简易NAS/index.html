<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.8.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"tachikomachann.github.io","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="最近尝试用树莓派和两块硬盘搭建了简易的NAS服务，稳定运行了几周，感觉还不错。今天把自己折腾的过程记录一下。 我对NAS的需求 2T左右的空间 个人多媒体库（我没有屯片习惯，主要是听歌和偶尔下载一些片子来看） 管理家庭照片（我和我老婆手机的照片） 备份 增量备份到老硬盘 异地备份到公有云（其实就是百度云） 定时备份系统，可快速还原系统   外网访问：查看文件，听音乐，看照片 用家里电视盒子看视频">
<meta name="keywords" content="nas,树莓派">
<meta property="og:type" content="article">
<meta property="og:title" content="用树莓派4B组件简易NAS">
<meta property="og:url" content="https://tachikomachann.github.io/2020/11/28/用树莓派4B组件简易NAS/index.html">
<meta property="og:site_name" content="タチコマの部屋">
<meta property="og:description" content="最近尝试用树莓派和两块硬盘搭建了简易的NAS服务，稳定运行了几周，感觉还不错。今天把自己折腾的过程记录一下。 我对NAS的需求 2T左右的空间 个人多媒体库（我没有屯片习惯，主要是听歌和偶尔下载一些片子来看） 管理家庭照片（我和我老婆手机的照片） 备份 增量备份到老硬盘 异地备份到公有云（其实就是百度云） 定时备份系统，可快速还原系统   外网访问：查看文件，听音乐，看照片 用家里电视盒子看视频">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://tachikomachann.github.io/2020/11/28/用树莓派4B组件简易NAS/nextcloud_home_page.png">
<meta property="og:image" content="https://tachikomachann.github.io/2020/11/28/用树莓派4B组件简易NAS/nextcloud_0770_error.png">
<meta property="og:image" content="https://tachikomachann.github.io/2020/11/28/用树莓派4B组件简易NAS/nextcloud_0770_config2.png">
<meta property="og:image" content="https://tachikomachann.github.io/2020/11/28/用树莓派4B组件简易NAS/nextcloud_scan.png">
<meta property="og:image" content="https://tachikomachann.github.io/2020/11/28/用树莓派4B组件简易NAS/boxcyptor.png">
<meta property="og:image" content="https://tachikomachann.github.io/2020/11/28/用树莓派4B组件简易NAS/boxcyptor2.png">
<meta property="og:image" content="https://tachikomachann.github.io/2020/11/28/用树莓派4B组件简易NAS/boxcyptor3.png">
<meta property="og:image" content="https://tachikomachann.github.io/2020/11/28/用树莓派4B组件简易NAS/mount1.png">
<meta property="og:image" content="https://tachikomachann.github.io/2020/11/28/用树莓派4B组件简易NAS/swithc1.png">
<meta property="og:image" content="https://tachikomachann.github.io/2020/11/28/用树莓派4B组件简易NAS/switch2.png">
<meta property="og:image" content="https://tachikomachann.github.io/2020/11/28/用树莓派4B组件简易NAS/rsync1.png">
<meta property="og:image" content="https://tachikomachann.github.io/2020/11/28/用树莓派4B组件简易NAS/rsync2.png">
<meta property="og:updated_time" content="2020-12-06T11:51:02.070Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="用树莓派4B组件简易NAS">
<meta name="twitter:description" content="最近尝试用树莓派和两块硬盘搭建了简易的NAS服务，稳定运行了几周，感觉还不错。今天把自己折腾的过程记录一下。 我对NAS的需求 2T左右的空间 个人多媒体库（我没有屯片习惯，主要是听歌和偶尔下载一些片子来看） 管理家庭照片（我和我老婆手机的照片） 备份 增量备份到老硬盘 异地备份到公有云（其实就是百度云） 定时备份系统，可快速还原系统   外网访问：查看文件，听音乐，看照片 用家里电视盒子看视频">
<meta name="twitter:image" content="https://tachikomachann.github.io/2020/11/28/用树莓派4B组件简易NAS/nextcloud_home_page.png">

<link rel="canonical" href="https://tachikomachann.github.io/2020/11/28/用树莓派4B组件简易NAS/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-Hans'
  };
</script>

  <title>用树莓派4B组件简易NAS | タチコマの部屋</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">タチコマの部屋</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://tachikomachann.github.io/2020/11/28/用树莓派4B组件简易NAS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Tachikoma">
      <meta itemprop="description" content="Less is more">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="タチコマの部屋">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          用树莓派4B组件简易NAS
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-28 21:42:04" itemprop="dateCreated datePublished" datetime="2020-11-28T21:42:04+08:00">2020-11-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-12-06 19:51:02" itemprop="dateModified" datetime="2020-12-06T19:51:02+08:00">2020-12-06</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>最近尝试用树莓派和两块硬盘搭建了简易的NAS服务，稳定运行了几周，感觉还不错。今天把自己折腾的过程记录一下。</p>
<h2 id="我对NAS的需求"><a href="#我对NAS的需求" class="headerlink" title="我对NAS的需求"></a>我对NAS的需求</h2><ol>
<li>2T左右的空间</li>
<li>个人多媒体库（我没有屯片习惯，主要是听歌和偶尔下载一些片子来看）</li>
<li>管理家庭照片（我和我老婆手机的照片）</li>
<li>备份<ol>
<li>增量备份到老硬盘</li>
<li>异地备份到公有云（其实就是百度云）</li>
<li>定时备份系统，可快速还原系统</li>
</ol>
</li>
<li>外网访问：查看文件，听音乐，看照片</li>
<li>用家里电视盒子看视频</li>
<li>长时间运行不折腾</li>
<li>可以休眠硬盘（其实现在大部分硬盘自带休眠功能）</li>
<li>定时开关机</li>
<li>消息推送：对于一些关注的事件，给我手机发通知（备份成功，开机，关机等等）</li>
</ol>
<h2 id="购物清单"><a href="#购物清单" class="headerlink" title="购物清单"></a>购物清单</h2><ol>
<li>咸鱼树莓派4B 2G版本，带外壳带风扇（260元）</li>
<li>闪迪16G SD卡2张（45元），一张做树莓派系统，一张作为备用</li>
<li>东芝新小黑A3 2T移动硬盘+2年包换（跟家里一个1T台式机硬盘配合着用）(418元)</li>
<li>腾讯云HK轻量服务器（安装frp作为内网穿透用）（每月24元）</li>
<li>腾讯云买的两年域名+免费一年证书（内网穿透用）（46元）</li>
<li>小米wifi插座（定时开关机用）（40元）</li>
<li>水星（MERCURY）SG105M 5口千兆交换机 （52元）</li>
</ol>
<a id="more"></a> 
<h2 id="组建NAS"><a href="#组建NAS" class="headerlink" title="组建NAS"></a>组建NAS</h2><p>趁着树莓派到货的间隙，查了许多有关树莓派搭建NAS的资料。其实按照目前的需求，我只需要一个网盘系统然后能够兼顾外网文件访问即可。网盘大家用的比较多的有Nextcloud和Seafile两个方案。一开始试过Seafile，发现一是安装太繁琐；二是它的文件是以块存储的方式，硬盘拆下来后，没办法绕过Seafile直接读取文件。最后决定使用Linux系统+Nextcloud作为个人网盘。</p>
<h3 id="系统安装"><a href="#系统安装" class="headerlink" title="系统安装"></a>系统安装</h3><p>树莓派支持的系统挺多的，由于之前用过一段时间Manjaro，对它有点好感，刚好它也有支持树莓派的镜像，索性就用Manjaro作为我的树莓派操作系统。PS: 不要以为可以跟桌面版Manjaro一样使用海量的AUR仓库里的软件，用到后面其实我发现，很多软件都没有对应arm的版本。选Manjaro单纯是因为我习惯了这个发行版。:)</p>
<p>安装过程跟树莓派其他系统大同小异：</p>
<ol>
<li>去Manjaro官网下载树莓派的镜像，因为基本不需要界面，所以我选的是xfce版本：<a href="https://manjaro.org/downloads/arm/raspberry-pi-4/arm8-raspberry-pi-4-xfce/" target="_blank" rel="noopener">https://manjaro.org/downloads/arm/raspberry-pi-4/arm8-raspberry-pi-4-xfce/</a></li>
<li>下载SD卡烧录工具Etcher：<a href="https://www.balena.io/etcher/" target="_blank" rel="noopener">https://www.balena.io/etcher/</a></li>
<li>用Etcher把系统镜像烧录到SD卡</li>
<li>将SD卡插入树莓派，通电启动。</li>
</ol>
<p>由于我没有买树莓派专用显示器，自己的显示器接树莓派又无法显示，所以我打算用SSH登录的方式初始化树莓派系统设置。（主流的树莓派系统都有这功能，防止因为显示输出问题，没办法设置树莓派。）PS：树莓派外接HDMI显示真的是很玄学的事情，我从买第一块树莓派的时候就没成功过。</p>
<p>SSH初始化系统的操作方式很简单：</p>
<ol>
<li>网线插入树莓派网口，让树莓派接入家里的局域网。</li>
<li>在家里路由器的管理员页面上找到树莓派分配到的IP。</li>
<li>在同一局域网内另一台计算机上运行SSH 连接：<code>ssh 树莓派IP</code></li>
<li>没问题的话，就可以SSH登录，进行系统初始化。</li>
</ol>
<p>注意：初始化系统时，键盘layout选us，时区选zh-CN-UTF-8。设置完成后，可以在路由器上固定分配树莓派的IP，以防以后内网分配的IP变动。</p>
<p>系统初始化以后，可以顺手更新下pacman的中国源：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman-mirrors -i -c China -m rank</span><br></pre></td></tr></table></figure>
<h3 id="安装Nextcloud"><a href="#安装Nextcloud" class="headerlink" title="安装Nextcloud"></a>安装Nextcloud</h3><p>Nextcloud有很多种安装方式，Docker方式应该算是最简单的，刚好我装的Manjaro系统也支持跑Docker服务，我就用Docker来运行Nextcloud了。</p>
<p>Nextcloud官方Docker镜像：<a href="https://hub.docker.com/_/nextcloud" target="_blank" rel="noopener">https://hub.docker.com/_/nextcloud</a>  </p>
<p>步骤：</p>
<ol>
<li><p>安装Docker服务。Manjaro 依托与Arch的pacman，安装Docker很方便：<code>pacman -Syy docker</code> 。</p>
</li>
<li><p>修改/etc/docker/daemon.json配置，使用国内镜像服务加速</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"registry-mirrors"</span>: [</span><br><span class="line">        <span class="string">"https://1nj0zren.mirror.aliyuncs.com"</span>,</span><br><span class="line">        <span class="string">"https://docker.mirrors.ustc.edu.cn"</span>,</span><br><span class="line">        <span class="string">"http://f1361db2.m.daocloud.io"</span>,</span><br><span class="line">        <span class="string">"https://registry.docker-cn.com"</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>重启docker 服务：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装docker-compose（官网最新的安装方式是用docker-compose组织Nextcloud需要的各个组件）。</p>
</li>
<li><p>按照官方Docker镜像的说明配置并启动Docker容器。(<a href="https://hub.docker.com/_/nextcloud" target="_blank" rel="noopener">https://hub.docker.com/_/nextcloud</a>)</p>
</li>
</ol>
<p>运行Nextcloud需要一个DB（Mysql/MariaDB 或PostgreSQL）,反向代理服务器（Apache或Nginx），Nextcloud本身的app（一个PHP服务），有多种搭配。我最终选择的是MariaDB+Nginx的方案，所以使用的是 <code>nextcloud:fpm</code> 的app镜像，下面是整个<code>docker-compose.yml</code>配置文件信息：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'2'</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line"><span class="attr">  nextcloud:</span></span><br><span class="line"><span class="attr">  db:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"><span class="attr">  db:</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">mariadb</span></span><br><span class="line"><span class="attr">    command:</span> <span class="bullet">--transaction-isolation=READ-COMMITTED</span> <span class="bullet">--binlog-format=ROW</span></span><br><span class="line"><span class="attr">    restart:</span> <span class="string">always</span></span><br><span class="line"><span class="attr">    volumes:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">./db:/var/lib/mysql</span></span><br><span class="line"><span class="attr">    environment:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">MYSQL_ROOT_PASSWORD=root</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">MYSQL_PASSWORD=nextcloud</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">MYSQL_DATABASE=nextcloud</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">MYSQL_USER=nextcloud</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#这里的Redis是为了开启Nextcloud的文件锁，没需求可以不用。</span></span><br><span class="line"><span class="attr">  redis:</span></span><br><span class="line"><span class="attr">    image:</span> <span class="attr">redis:alpine</span></span><br><span class="line"><span class="attr">    restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line"><span class="attr">  app:</span></span><br><span class="line">  <span class="comment"># 要使用nginx的方案的话，镜像应该是nextcloud:fpm</span></span><br><span class="line"><span class="attr">    image:</span> <span class="attr">nextcloud:fpm</span></span><br><span class="line"><span class="attr">    volumes:</span></span><br><span class="line">      <span class="comment"># 挂载Nextcloud的应用程序目录，各种php程序文件和配置文件</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">./nextcloud:/var/www/html</span></span><br><span class="line">      <span class="comment"># 挂载Nextcloud 的存储目录，用户存储的文件就在这个目录下</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">./nextcloud_data:/var/www/html/data</span></span><br><span class="line"><span class="attr">    restart:</span> <span class="string">always</span></span><br><span class="line"><span class="attr">    environment:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">MYSQL_HOST=db</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">REDIS_HOST=redis</span></span><br><span class="line"><span class="attr">    depends_on:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">db</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">redis</span></span><br><span class="line">  <span class="comment">#用于执行一些定时任务的Nextcloud插件，不需要也可以不装。</span></span><br><span class="line"><span class="attr">  cron:</span></span><br><span class="line"><span class="attr">    image:</span> <span class="attr">nextcloud:fpm-alpine</span></span><br><span class="line"><span class="attr">    restart:</span> <span class="string">always</span></span><br><span class="line"><span class="attr">    volumes:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">./nextcloud:/var/www/html</span></span><br><span class="line"><span class="attr">    entrypoint:</span> <span class="string">/cron.sh</span></span><br><span class="line"><span class="attr">    depends_on:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">db</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">redis</span></span><br><span class="line"></span><br><span class="line"><span class="attr">  web:</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="number">8080</span><span class="string">:80</span></span><br><span class="line"><span class="attr">    depends_on:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">app</span></span><br><span class="line"><span class="attr">    volumes:</span></span><br><span class="line">     <span class="comment"># 挂载nginx的配置文件</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">./nginx.conf:/etc/nginx/nginx.conf:ro</span></span><br><span class="line"><span class="attr">    volumes_from:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">app</span></span><br><span class="line"><span class="attr">    restart:</span> <span class="string">always</span></span><br></pre></td></tr></table></figure>
<p><code>nignx.conf</code> 的配置可以参考官方的<a href="https://github.com/nextcloud/docker/blob/master/.examples/docker-compose/with-nginx-proxy/mariadb/fpm/web/nginx.conf" target="_blank" rel="noopener">example</a>： </p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">worker_processes</span> auto;</span><br><span class="line"></span><br><span class="line"><span class="attribute">error_log</span>  /var/log/nginx/error.log <span class="literal">warn</span>;</span><br><span class="line"><span class="attribute">pid</span>        /var/run/nginx.pid;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">worker_connections</span>  <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">include</span>       /etc/nginx/mime.types;</span><br><span class="line">    <span class="attribute">default_type</span>  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">log_format</span>  main  <span class="string">'<span class="variable">$remote_addr</span> - <span class="variable">$remote_user</span> [<span class="variable">$time_local</span>] "<span class="variable">$request</span>" '</span></span><br><span class="line">                      <span class="string">'<span class="variable">$status</span> <span class="variable">$body_bytes_sent</span> "<span class="variable">$http_referer</span>" '</span></span><br><span class="line">                      <span class="string">'"<span class="variable">$http_user_agent</span>" "<span class="variable">$http_x_forwarded_for</span>"'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">access_log</span>  /var/log/nginx/access.log  main;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">sendfile</span>        <span class="literal">on</span>;</span><br><span class="line">    <span class="comment">#tcp_nopush     on;</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">keepalive_timeout</span>  <span class="number">65</span>;</span><br><span class="line">    <span class="attribute">client_max_body_size</span>        <span class="number">2G</span>;</span><br><span class="line">    <span class="attribute">client_body_buffer_size</span>     <span class="number">400M</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#gzip  on;</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">upstream</span> php-handler &#123;</span><br><span class="line">        <span class="attribute">server</span> app:<span class="number">9000</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Add headers to serve security related headers</span></span><br><span class="line">        <span class="comment"># Before enabling Strict-Transport-Security headers please read into this</span></span><br><span class="line">        <span class="comment"># topic first.</span></span><br><span class="line">        <span class="comment">#add_header Strict-Transport-Security "max-age=15768000; includeSubDomains; preload;" always;</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># WARNING: Only add the preload option once you read about</span></span><br><span class="line">        <span class="comment"># the consequences in https://hstspreload.org/. This option</span></span><br><span class="line">        <span class="comment"># will add the domain to a hardcoded list that is shipped</span></span><br><span class="line">        <span class="comment"># in all major browsers and getting removed from this list</span></span><br><span class="line">        <span class="comment"># could take several months.</span></span><br><span class="line">        <span class="attribute">add_header</span> Referrer-Policy <span class="string">"no-referrer"</span> always;</span><br><span class="line">        <span class="attribute">add_header</span> X-Content-Type-Options <span class="string">"nosniff"</span> always;</span><br><span class="line">        <span class="attribute">add_header</span> X-Download-Options <span class="string">"noopen"</span> always;</span><br><span class="line">        <span class="attribute">add_header</span> X-Frame-Options <span class="string">"SAMEORIGIN"</span> always;</span><br><span class="line">        <span class="attribute">add_header</span> X-Permitted-Cross-Domain-Policies <span class="string">"none"</span> always;</span><br><span class="line">        <span class="attribute">add_header</span> X-Robots-Tag <span class="string">"none"</span> always;</span><br><span class="line">        <span class="attribute">add_header</span> X-XSS-Protection <span class="string">"1; mode=block"</span> always;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Remove X-Powered-By, which is an information leak</span></span><br><span class="line">        <span class="attribute">fastcgi_hide_header</span> X-Powered-By;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Path to the root of your installation</span></span><br><span class="line">        <span class="attribute">root</span> /var/www/html;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">location</span> = /robots.txt &#123;</span><br><span class="line">            <span class="attribute">allow</span> all;</span><br><span class="line">            <span class="attribute">log_not_found</span> <span class="literal">off</span>;</span><br><span class="line">            <span class="attribute">access_log</span> <span class="literal">off</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># The following 2 rules are only needed for the user_webfinger app.</span></span><br><span class="line">        <span class="comment"># Uncomment it if you're planning to use this app.</span></span><br><span class="line">        <span class="comment">#rewrite ^/.well-known/host-meta /public.php?service=host-meta last;</span></span><br><span class="line">        <span class="comment">#rewrite ^/.well-known/host-meta.json /public.php?service=host-meta-json last;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># The following rule is only needed for the Social app.</span></span><br><span class="line">        <span class="comment"># Uncomment it if you're planning to use this app.</span></span><br><span class="line">        <span class="comment">#rewrite ^/.well-known/webfinger /public.php?service=webfinger last;</span></span><br><span class="line"></span><br><span class="line">        <span class="attribute">location</span> = /.well-known/carddav &#123;</span><br><span class="line">            <span class="attribute">return</span> <span class="number">301</span> <span class="variable">$scheme</span>://<span class="variable">$host</span>:<span class="variable">$server_port</span>/remote.php/dav;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">location</span> = /.well-known/caldav &#123;</span><br><span class="line">            <span class="attribute">return</span> <span class="number">301</span> <span class="variable">$scheme</span>://<span class="variable">$host</span>:<span class="variable">$server_port</span>/remote.php/dav;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># set max upload size</span></span><br><span class="line">        <span class="attribute">client_max_body_size</span> <span class="number">10G</span>;</span><br><span class="line">        <span class="attribute">fastcgi_buffers</span> <span class="number">64</span> <span class="number">4K</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Enable gzip but do not remove ETag headers</span></span><br><span class="line">        <span class="attribute">gzip</span> <span class="literal">on</span>;</span><br><span class="line">        <span class="attribute">gzip_vary</span> <span class="literal">on</span>;</span><br><span class="line">        <span class="attribute">gzip_comp_level</span> <span class="number">4</span>;</span><br><span class="line">        <span class="attribute">gzip_min_length</span> <span class="number">256</span>;</span><br><span class="line">        <span class="attribute">gzip_proxied</span> expired <span class="literal">no</span>-cache <span class="literal">no</span>-store private no_last_modified no_etag auth;</span><br><span class="line">        <span class="attribute">gzip_types</span> application/atom+xml application/javascript application/json application/ld+json application/manifest+json application/rss+xml application/vnd.geo+json application/vnd.ms-fontobject application/x-font-ttf application/x-web-app-manifest+json application/xhtml+xml application/xml font/opentype image/bmp image/svg+xml image/x-icon text/cache-manifest text/css text/plain text/vcard text/vnd.rim.location.xloc text/vtt text/x-component text/x-cross-domain-policy;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Uncomment if your server is build with the ngx_pagespeed module</span></span><br><span class="line">        <span class="comment"># This module is currently not supported.</span></span><br><span class="line">        <span class="comment">#pagespeed off;</span></span><br><span class="line"></span><br><span class="line">        <span class="attribute">location</span> / &#123;</span><br><span class="line">            <span class="attribute">rewrite</span><span class="regexp"> ^</span> /index.php;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">location</span> <span class="regexp">~ ^\/(?:build|tests|config|lib|3rdparty|templates|data)\/</span> &#123;</span><br><span class="line">            <span class="attribute">deny</span> all;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="attribute">location</span> <span class="regexp">~ ^\/(?:\.|autotest|occ|issue|indie|db_|console)</span> &#123;</span><br><span class="line">            <span class="attribute">deny</span> all;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">location</span> <span class="regexp">~ ^\/(?:index|remote|public|cron|core\/ajax\/update|status|ocs\/v[12]|updater\/.+|oc[ms]-provider\/.+)\.php(?:$|\/)</span> &#123;</span><br><span class="line">            <span class="attribute">fastcgi_split_path_info</span><span class="regexp"> ^(.+?\.php)(\/.*|)$</span>;</span><br><span class="line">            <span class="attribute">set</span> <span class="variable">$path_info</span> <span class="variable">$fastcgi_path_info</span>;</span><br><span class="line">            <span class="attribute">try_files</span> <span class="variable">$fastcgi_script_name</span> =<span class="number">404</span>;</span><br><span class="line">            <span class="attribute">include</span> fastcgi_params;</span><br><span class="line">            <span class="attribute">fastcgi_param</span> SCRIPT_FILENAME <span class="variable">$document_root</span><span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">            <span class="attribute">fastcgi_param</span> PATH_INFO <span class="variable">$path_info</span>;</span><br><span class="line">            <span class="comment"># fastcgi_param HTTPS on;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># Avoid sending the security headers twice</span></span><br><span class="line">            <span class="attribute">fastcgi_param</span> modHeadersAvailable <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Enable pretty urls</span></span><br><span class="line">            <span class="attribute">fastcgi_param</span> front_controller_active <span class="literal">true</span>;</span><br><span class="line">            <span class="attribute">fastcgi_pass</span> php-handler;</span><br><span class="line">            <span class="attribute">fastcgi_intercept_errors</span> <span class="literal">on</span>;</span><br><span class="line">            <span class="attribute">fastcgi_request_buffering</span> <span class="literal">off</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">location</span> <span class="regexp">~ ^\/(?:updater|oc[ms]-provider)(?:$|\/)</span> &#123;</span><br><span class="line">            <span class="attribute">try_files</span> <span class="variable">$uri</span>/ =<span class="number">404</span>;</span><br><span class="line">            <span class="attribute">index</span> index.php;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Adding the cache control header for js, css and map files</span></span><br><span class="line">        <span class="comment"># Make sure it is BELOW the PHP block</span></span><br><span class="line">        <span class="attribute">location</span> <span class="regexp">~ \.(?:css|js|woff2?|svg|gif|map)$</span> &#123;</span><br><span class="line">            <span class="attribute">try_files</span> <span class="variable">$uri</span> /index.php<span class="variable">$request_uri</span>;</span><br><span class="line">            <span class="attribute">add_header</span> Cache-Control <span class="string">"public, max-age=15778463"</span>;</span><br><span class="line">            <span class="comment"># Add headers to serve security related headers (It is intended to</span></span><br><span class="line">            <span class="comment"># have those duplicated to the ones above)</span></span><br><span class="line">            <span class="comment"># Before enabling Strict-Transport-Security headers please read into</span></span><br><span class="line">            <span class="comment"># this topic first.</span></span><br><span class="line">            <span class="comment">#add_header Strict-Transport-Security "max-age=15768000; includeSubDomains; preload;" always;</span></span><br><span class="line">            <span class="comment">#</span></span><br><span class="line">            <span class="comment"># WARNING: Only add the preload option once you read about</span></span><br><span class="line">            <span class="comment"># the consequences in https://hstspreload.org/. This option</span></span><br><span class="line">            <span class="comment"># will add the domain to a hardcoded list that is shipped</span></span><br><span class="line">            <span class="comment"># in all major browsers and getting removed from this list</span></span><br><span class="line">            <span class="comment"># could take several months.</span></span><br><span class="line">            <span class="attribute">add_header</span> Referrer-Policy <span class="string">"no-referrer"</span> always;</span><br><span class="line">            <span class="attribute">add_header</span> X-Content-Type-Options <span class="string">"nosniff"</span> always;</span><br><span class="line">            <span class="attribute">add_header</span> X-Download-Options <span class="string">"noopen"</span> always;</span><br><span class="line">            <span class="attribute">add_header</span> X-Frame-Options <span class="string">"SAMEORIGIN"</span> always;</span><br><span class="line">            <span class="attribute">add_header</span> X-Permitted-Cross-Domain-Policies <span class="string">"none"</span> always;</span><br><span class="line">            <span class="attribute">add_header</span> X-Robots-Tag <span class="string">"none"</span> always;</span><br><span class="line">            <span class="attribute">add_header</span> X-XSS-Protection <span class="string">"1; mode=block"</span> always;</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Optional: Don't log access to assets</span></span><br><span class="line">            <span class="attribute">access_log</span> <span class="literal">off</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">location</span> <span class="regexp">~ \.(?:png|html|ttf|ico|jpg|jpeg|bcmap|mp4|webm)$</span> &#123;</span><br><span class="line">            <span class="attribute">try_files</span> <span class="variable">$uri</span> /index.php<span class="variable">$request_uri</span>;</span><br><span class="line">            <span class="comment"># Optional: Don't log access to other assets</span></span><br><span class="line">            <span class="attribute">access_log</span> <span class="literal">off</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面配置都准备好以后，在docker-compose.yml文件的目录下，运行<code>sudo docker-compose up -d</code> 启动所有需要的容器，然后访问树莓派的80端口，就可以访问Nextcloud服务了。第一次访问会有些初始化的配置，跟着提示来就行了。</p>
<p>整个Nextcloud用起来跟百度网盘没什么区别：<img src="nextcloud_home_page.png" alt="nextcloud_home_page"></p>
<h3 id="关于Nextcloud的一些Troubleshooting"><a href="#关于Nextcloud的一些Troubleshooting" class="headerlink" title="关于Nextcloud的一些Troubleshooting"></a>关于Nextcloud的一些Troubleshooting</h3><h4 id="错误信息：您的数据目录可被其他用户读取，请更改权限为-0770-以避免其他用户查看目录"><a href="#错误信息：您的数据目录可被其他用户读取，请更改权限为-0770-以避免其他用户查看目录" class="headerlink" title="错误信息：您的数据目录可被其他用户读取，请更改权限为 0770 以避免其他用户查看目录"></a>错误信息：您的数据目录可被其他用户读取，请更改权限为 0770 以避免其他用户查看目录</h4><p><img src="nextcloud_0770_error.png" alt="nextcloud_0770_error"></p>
<p>据说是因为挂载的NTFS硬盘不支持直接直接设置0770文件权限的问题。其实整个树莓派都是自己控制的，文件权限没必要太严格，可以通过下面配置忽略Nextcloud的这个文件权限检查。在Nextcloud的config.php配置文件（对于我的配置，就是.nextcloud/config/config.php）里加一行：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'check_data_directory_permissions'</span> =&gt; <span class="keyword">false</span>,</span><br></pre></td></tr></table></figure>
<p><img src="nextcloud_0770_config2.png" alt="nextcloud_0770_config2"></p>
<h4 id="直接拷贝文件到-Nextcloud-用户的files目录里，在Nextcloud识别不到"><a href="#直接拷贝文件到-Nextcloud-用户的files目录里，在Nextcloud识别不到" class="headerlink" title="直接拷贝文件到 Nextcloud 用户的files目录里，在Nextcloud识别不到"></a>直接拷贝文件到 Nextcloud 用户的files目录里，在Nextcloud识别不到</h4><p>需要让Nextcloud 重建文件索引，这里使用他的OCC命令扫描文件目录重建索引：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker-compose -f Nextcloud的docker-compose.yml配置文件所在目录 exec  --user www-data app php occ   files:scan nextcloud用户名 -v</span><br></pre></td></tr></table></figure>
<p>速度挺快的：</p>
<p><img src="nextcloud_scan.png" alt="nextcloud_scan"></p>
<h4 id="备份Nextcloud-的DB"><a href="#备份Nextcloud-的DB" class="headerlink" title="备份Nextcloud 的DB"></a>备份Nextcloud 的DB</h4><p>用docker连接 nextcloud的数据库：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker  run -it --network nextcloud-docker_default  --rm mariadb mysql -hnextcloud-docker_db_1 -unextcloud -p</span><br></pre></td></tr></table></figure>
<p>dump整个db:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker exec nextcloud-docker_db_1 sh -c 'exec mysqldump --all-databases -uroot -p"root"' &gt; 导出的dump文件.sql</span><br></pre></td></tr></table></figure>
<p>从dump恢复</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker exec -i nextcloud-docker_db_1  sh -c 'exec mysql -uroot -p"root"' &lt; 要dump文件.sql</span><br></pre></td></tr></table></figure>
<h4 id="加上反向代理（外网访问有用）"><a href="#加上反向代理（外网访问有用）" class="headerlink" title="加上反向代理（外网访问有用）"></a>加上反向代理（外网访问有用）</h4><p>比如我想在家里的路由器安装frpc客户端（内网ip端口：192.168.123.134:11810）做内网穿透用，这个时候就要加入可信任的反向代理服务器列表，在config.php中添加配置：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'proxy'</span> =&gt; <span class="string">'192.168.123.134:11810'</span>,</span><br><span class="line"><span class="string">'trusted_proxies'</span> =&gt; <span class="keyword">array</span>(<span class="string">'192.168.123.134'</span>),</span><br></pre></td></tr></table></figure>
<h4 id="端到端加密"><a href="#端到端加密" class="headerlink" title="端到端加密"></a>端到端加密</h4><p>官方Encryption组件有支持端到端加密，但是问题很多。如果真的有这方面需求，可以考虑第三方方案，我这里用的是<a href="https://www.boxcryptor.com/en/" target="_blank" rel="noopener">Boxcyptor</a>方式，对某些个人比较私密的文件夹进行端到端加密（其实是为了这个另成NAS硬盘2年内挂掉时，返修的安全性：）） 。Boxcyptor官方支持Nextcloud，第一次使用按照引导配置就行。免费的Boxcyptor支持两个设备上使用，对我来说够用了。</p>
<p><img src="boxcyptor.png" alt="boxcyptor"></p>
<p>用它加密的Nextcloud文件，只能通过Boxcyptor查看，直接通过硬盘或者网页版Nextcloud查看都是加密的文件。</p>
<p><img src="boxcyptor2.png" alt="boxcyptor2"></p>
<p><img src="boxcyptor3.png" alt="boxcyptor3"></p>
<p>PS: Boxcryptor 的android 客户端只有公网域名的地址能连接，内网地址不行，不知道为啥。</p>
<h4 id="听歌"><a href="#听歌" class="headerlink" title="听歌"></a>听歌</h4><p>Nextcloud安装audio player和music插件可以实现在网页版Nextcloud里播放音乐文件。Android安装CloudBeats可以连接到Nextcloud里串流听音乐。</p>
<p>至于想要实现像网易云那样的自建音乐服务，需要一些其他方案（比如subsonic，plex，koel之类的）。目前CloudBeats对我来说够用，后续有空可能会再折腾折腾。</p>
<h3 id="针对这个树莓派NAS的一些其他设置"><a href="#针对这个树莓派NAS的一些其他设置" class="headerlink" title="针对这个树莓派NAS的一些其他设置"></a>针对这个树莓派NAS的一些其他设置</h3><h4 id="开机挂载硬盘"><a href="#开机挂载硬盘" class="headerlink" title="开机挂载硬盘"></a>开机挂载硬盘</h4><p>这里应该用硬盘的UUID挂载，用盘符/dev/sda1挂载可能不准确，因为盘符有时候会变动。</p>
<p>先用 <code>sudo blkid</code> 查看一下设备UUID</p>
<p><img src="mount1.png" alt="mount1"></p>
<p>然后编辑 /etc/fstab，添加一行，使其开启自动mount改设备</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UUID=设备的UUID  /mnt/sda1   ntfs-3g    defaults        0       0</span><br></pre></td></tr></table></figure>
<p>之后每次启动就会自动挂载这个硬盘到/mnt/sda1目录。</p>
<h4 id="使用千兆交换机，升级内网传输速度"><a href="#使用千兆交换机，升级内网传输速度" class="headerlink" title="使用千兆交换机，升级内网传输速度"></a>使用千兆交换机，升级内网传输速度</h4><p>一切都配置完成，并开启samba服务后，发现内网拷贝文件速度还是有点慢，远达不到树莓派USB3.0和5400转机械硬盘的读写速度，后面自己分析了一下，发现瓶颈在家里的交换机，一直用的是百兆的。换了千兆交换机后，内网拷贝速度有了显著提升（虽然还没到真正NAS的标准，但是目前也满足我需求了）。</p>
<p>百兆交换机拷贝速度：</p>
<p><img src="swithc1.png" alt="swithc1"></p>
<p>升级千兆交换机后拷贝速度：</p>
<p><img src="switch2.png" alt="switch2"></p>
<h4 id="开启SMB服务"><a href="#开启SMB服务" class="headerlink" title="开启SMB服务"></a>开启SMB服务</h4><p>虽然Nextcloud已经够用了，但是偶尔我还是会有需要内网直接访问硬盘文件或者通过家里的电视盒子看NAS里的片子的需求，所以就顺手开启了Samba服务。Manjaro如何开启Samba，可以直接参考Arch关于Samba的<a href="https://wiki.archlinux.org/index.php/samba" target="_blank" rel="noopener">wiki</a>。</p>
<h4 id="定时开关机"><a href="#定时开关机" class="headerlink" title="定时开关机"></a>定时开关机</h4><p>树莓派本身耗电挺小的，不过考虑到延长硬盘寿命，我还是做了定时开关机。实现也很简单，每天晚上12点执行脚本，umount掉所有硬盘，然后poweroff，早上通过小米只能插座每天6点触发通电开关开机。</p>
<h3 id="备份方案"><a href="#备份方案" class="headerlink" title="备份方案"></a>备份方案</h3><p>由于目前我并不是重度使用NAS，同时也考虑经济成本，所以并不打算做RAID之类方案。目前就是外挂两块硬盘，一块当NAS文件存放盘，一块作为冷备份每天挂载上来增量同步，同时搭配百度网盘的免费空间，定期往百度网盘同步重要资料。</p>
<h4 id="使用rsync增量本分数据到备份硬盘"><a href="#使用rsync增量本分数据到备份硬盘" class="headerlink" title="使用rsync增量本分数据到备份硬盘"></a>使用rsync增量本分数据到备份硬盘</h4><p>我的备份方案是用另一块硬盘每天增量备份数据，所以这里用到了rsync。挂载备份的硬盘后，命令挺简单，就一行：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo rsync --delete -a -r -v -P --progress  /mnt/sda1/  /mnt/sdb1</span><br></pre></td></tr></table></figure>
<p>注意这里一定要有-a(arvhive mode)，这样拷贝过去的文件，会在目标文件保留源文件所有属性（比如最后修改时间mtime，如果没有加-a，下次同步的时候，目标文件的mtime跟源文件不同，同样的文件又会复制一次，这就达不到增量备份的目的了）。</p>
<p>没有加-a 拷贝后：</p>
<p><img src="rsync1.png" alt="rsync1"></p>
<p>有加-a拷贝后：</p>
<p><img src="rsync2.png" alt="rsync2"></p>
<p>后面再搭配linux的cron服务，就可以实现每天自动增量备份一次全盘数据了。</p>
<h4 id="全量备份树莓派系统"><a href="#全量备份树莓派系统" class="headerlink" title="全量备份树莓派系统"></a>全量备份树莓派系统</h4><p>这里用的是dd整张SD卡，然后打包。</p>
<p>每周执行一次以下命令备份系统：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dd bs=4M if=/dev/sd卡 | gzip &gt; 备份文件目录/备份文件名.img.gz</span><br></pre></td></tr></table></figure>
<p>运行后命令行会卡住，直到备份结束，16g的SD卡差不多花费十几分钟。</p>
<p>如果想看进度，在另一个命令行中输入：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch -d -n 5 ls -lh 备份文件目录/备份文件名.img.gz</span><br></pre></td></tr></table></figure>
<h4 id="使用百度网盘做为公有云备份"><a href="#使用百度网盘做为公有云备份" class="headerlink" title="使用百度网盘做为公有云备份"></a>使用百度网盘做为公有云备份</h4><p>使用两块硬盘不做Raid还是有一定的数据丢失风险的，所以我同时使用了百度网盘作为另一个备份方案。这里用到了<a href="https://github.com/houtianze/bypy" target="_blank" rel="noopener">bypy</a>这个百度网盘这个python写的命令行客户端。虽然目前该项目已经停止开发，但还是能正常使用，满足我上传备份文件的需求。通过配置定时计划的方式，我将一些重要资料，照片归档，系统全量备份文件等定时打包上传百度网盘。目前百度网盘免费空间2T，跟我本地硬盘一样大，算是够我使用了。 </p>
<h4 id="配置Cron定时计划"><a href="#配置Cron定时计划" class="headerlink" title="配置Cron定时计划"></a>配置Cron定时计划</h4><p>首先是安装cronie，它是cron的其中一种实现。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -Syy cronie</span><br></pre></td></tr></table></figure>
<p>然后用crontab -e，编辑自己想要的cron的定时计划，我把上面用到的备份都写成了shell脚本，定时执行。</p>
<p>cronie的日志在systemd的journal日志里， 要想看cronie的日志的话，可以使用 journalctl。</p>
<h4 id="使用Server酱发送通知到手机"><a href="#使用Server酱发送通知到手机" class="headerlink" title="使用Server酱发送通知到手机"></a>使用Server酱发送通知到手机</h4><p><a href="http://sc.ftqq.com/3.version" target="_blank" rel="noopener">Server酱</a>是一个易用，免费的往微信发送通知的API，使用方式也非常简单，使用申请的key直接调用它的http接口就能往自己微信发送消息，非常适合整合在自己的服务端维护脚本里。我把上面在cron里用到的定时计划脚本都添加了Server酱的通知，方面追踪各个任务每天的执行成功/失败情况。</p>
<h3 id="外网访问"><a href="#外网访问" class="headerlink" title="外网访问"></a>外网访问</h3><p>到目前为止，就可以使用Nextcloud和SMB服务在内网访问NAS的文件了，剩下的就是怎么搞定外网访问。</p>
<p>外网访问的方案有很多种，但是总结起来就两类：一类是你的NAS所属的网络本身就暴露在公网上，也就是你们家有公网IP，这个时候就可以上DDNS把你的NAS服务挂在某个域名下;另一类是NAS是身处内网，你需要另一台能公网访问的机器（如各种云主机）与它通信（各种内网穿透方案，frp，花生棒什么的），然后你通过访问这台公网机器达到间接访问公网NAS文件的目的。</p>
<p>以前我们家是电信宽带，后来为了省钱换成了移动，无奈只能用第二种方案（省下的钱还是要掏出来了）。对比了各种内网穿透方案，最终决定采用买云主机自建frp服务的方式。然后直接http云主机感觉不够安全，于是又买了个便宜的域名和免费的SSL证书给终端frp访问套上一层HTTPS（真是折腾不止。。。）。</p>
<h4 id="买云主机"><a href="#买云主机" class="headerlink" title="买云主机"></a>买云主机</h4><p>其实我做公网访问主要原因就是想弃用网易云，随时听自己硬盘里的歌，所以这里还要考虑流量的问题。中国大陆的云主机服务流量都太贵了，最便宜的机器基本标配1M小水管，极限上传速度只有128K，现在一10M以内的歌，估计够呛。要是买国外的机器，访问是个问题，按照以前用搬瓦工和DO的经验，有时候网络访问还不如国内这些1M小水管。后来各大论坛查了一圈，发现腾讯云的HK轻量应用服务器还不错，1U1G，30Mbps带宽一个月1T流量只要24元/月，买来试用了一下，发现我这边访问速度还不错（起码听歌，下文件是没问题的），就打算用它来搭建内网穿透服务了。</p>
<h4 id="用frp搭建内网穿透服务"><a href="#用frp搭建内网穿透服务" class="headerlink" title="用frp搭建内网穿透服务"></a>用frp搭建内网穿透服务</h4><p>搭建frp网上教程一大把，这里说说我的思路：</p>
<ol>
<li>首先是在云主机上安装frps，即frp的server端。</li>
<li>然后在家里的路由器安装frpc，即frp的client端。</li>
<li>然后在路由器上配置端口转发，把frpc过来的请求转发到内网的Nextcloud去。</li>
</ol>
<p>这样就实现了公网访问家里树莓派Nextcloud服务。我没有采用直接在树莓派上装frpc的方式，主要是考虑到安全问题，因为一旦树莓派暴露了，其实家里的其他内网设备都能访问了，但是路由器不一样，路由器有自己的防火墙和其他安全策略，在暴露有限端口的情况下，我觉得还是更安全的。而且我们家路由器是刷了padavan系统的，自带frpc，只要导入配置就好了，也比较省事。</p>
<p>内网穿透相当于给Nextcloud加了一个反向代理，所以Nextcloud也要加一个配置，把云主机的IP和frps端口配到config.php的trusted_domains中：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'trusted_domains'</span> =&gt;</span><br><span class="line"><span class="keyword">array</span> (</span><br><span class="line">  <span class="comment"># 把云主机的ip和frps的端口放到这里（例子里的ip我瞎写的）</span></span><br><span class="line">  <span class="number">0</span> =&gt; <span class="string">'119.28.255.255:10080'</span>,</span><br><span class="line">  <span class="comment"># 如果有配置域名，域名也得放进来</span></span><br><span class="line">  <span class="number">1</span> =&gt; <span class="string">'domain.nas.com'</span>,</span><br><span class="line">),</span><br></pre></td></tr></table></figure>
<h4 id="申请域名和证书"><a href="#申请域名和证书" class="headerlink" title="申请域名和证书"></a>申请域名和证书</h4><p>由于云主机是买的腾讯云的，为了省事，索性域名和免费证书也用他家的了。域名随便挑了个便宜顺眼的xyz域名，46块钱2年。然后顺便申请了他家一年的免费证书，通过教程简单操作几下，不到一个小时就完成了域名注册，配置，开启HTTPS，整个过程还是蛮顺利的。不过据说腾讯云一年的免费证书以后续期很不方便，还是用Let’s Encrypt然后写脚本三个月自动续签比较好。目前我还是这个白嫖证书先用着，等明年到期了再试试Let’s Encrypt的方案。</p>
<p>开启HTTPS后，Nextcloud的confg.php还要再加点小配置：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 以下两行表示：只有在源ip是192.168.222.1时，才强制使用https协议</span></span><br><span class="line"><span class="comment"># 主要用于公网域名https内网穿透访问。其中192.168.123.222为安装了frpc的路由器ip</span></span><br><span class="line"><span class="string">'overwriteprotocol'</span> =&gt; <span class="string">'https'</span>,</span><br><span class="line"><span class="string">'overwritecondaddr'</span> =&gt; <span class="string">'^192\.168\.123\.222$'</span>,</span><br></pre></td></tr></table></figure>
<p>上面的配置主要是为了重写Nextcloud的baseurl，大部分情况下Nextcloud都能通过客户端访问的情况，在需要的时候拼接出Nextcloud站点的地址（比如生成WebDAV url的时候）。但有时候会失误，比如目前我的HTTPS方案，它会识别不了我是HTTPS访问的，拼接出来的WebDAV url还是http开头的，上面的配置就是告诉Nextcloud，用户访问来源是192.168.123.222（我装有frpc的路由器ip），他是https协议的，为他生成的url必须用https的。</p>
<h2 id="大功告成"><a href="#大功告成" class="headerlink" title="大功告成"></a>大功告成</h2><p>说实话，花了一个国庆假期搞的这套树莓派NAS，其实不算是NAS，只是一个自建的网盘和文件服务器。但是它基本满足了我们家目前对NAS的需求。自从搭完以来，两块硬盘一个树莓派放在角落里基本没在管它，每天检查一下Server酱的定时计划执行结果，自动备份照片，偶尔听听歌，放个片子，不用在纠结各家音乐服务的会员，感觉还是很不错的。</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/nas/" rel="tag"># nas</a>
              <a href="/tags/树莓派/" rel="tag"># 树莓派</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2019/12/22/SAML-与-SSO/" rel="prev" title="SAML 与 SSO">
      <i class="fa fa-chevron-left"></i> SAML 与 SSO
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/12/06/关于MySQL出现'Deadlock found when trying to get lock'的一点思考/" rel="next" title="关于MySQL出现'Deadlock found when trying to get lock'的一点思考">
      关于MySQL出现'Deadlock found when trying to get lock'的一点思考 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#我对NAS的需求"><span class="nav-number">1.</span> <span class="nav-text">我对NAS的需求</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#购物清单"><span class="nav-number">2.</span> <span class="nav-text">购物清单</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#组建NAS"><span class="nav-number">3.</span> <span class="nav-text">组建NAS</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#系统安装"><span class="nav-number">3.1.</span> <span class="nav-text">系统安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装Nextcloud"><span class="nav-number">3.2.</span> <span class="nav-text">安装Nextcloud</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#关于Nextcloud的一些Troubleshooting"><span class="nav-number">3.3.</span> <span class="nav-text">关于Nextcloud的一些Troubleshooting</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#错误信息：您的数据目录可被其他用户读取，请更改权限为-0770-以避免其他用户查看目录"><span class="nav-number">3.3.1.</span> <span class="nav-text">错误信息：您的数据目录可被其他用户读取，请更改权限为 0770 以避免其他用户查看目录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#直接拷贝文件到-Nextcloud-用户的files目录里，在Nextcloud识别不到"><span class="nav-number">3.3.2.</span> <span class="nav-text">直接拷贝文件到 Nextcloud 用户的files目录里，在Nextcloud识别不到</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#备份Nextcloud-的DB"><span class="nav-number">3.3.3.</span> <span class="nav-text">备份Nextcloud 的DB</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#加上反向代理（外网访问有用）"><span class="nav-number">3.3.4.</span> <span class="nav-text">加上反向代理（外网访问有用）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#端到端加密"><span class="nav-number">3.3.5.</span> <span class="nav-text">端到端加密</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#听歌"><span class="nav-number">3.3.6.</span> <span class="nav-text">听歌</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#针对这个树莓派NAS的一些其他设置"><span class="nav-number">3.4.</span> <span class="nav-text">针对这个树莓派NAS的一些其他设置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#开机挂载硬盘"><span class="nav-number">3.4.1.</span> <span class="nav-text">开机挂载硬盘</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#使用千兆交换机，升级内网传输速度"><span class="nav-number">3.4.2.</span> <span class="nav-text">使用千兆交换机，升级内网传输速度</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#开启SMB服务"><span class="nav-number">3.4.3.</span> <span class="nav-text">开启SMB服务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#定时开关机"><span class="nav-number">3.4.4.</span> <span class="nav-text">定时开关机</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#备份方案"><span class="nav-number">3.5.</span> <span class="nav-text">备份方案</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#使用rsync增量本分数据到备份硬盘"><span class="nav-number">3.5.1.</span> <span class="nav-text">使用rsync增量本分数据到备份硬盘</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#全量备份树莓派系统"><span class="nav-number">3.5.2.</span> <span class="nav-text">全量备份树莓派系统</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#使用百度网盘做为公有云备份"><span class="nav-number">3.5.3.</span> <span class="nav-text">使用百度网盘做为公有云备份</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#配置Cron定时计划"><span class="nav-number">3.5.4.</span> <span class="nav-text">配置Cron定时计划</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#使用Server酱发送通知到手机"><span class="nav-number">3.5.5.</span> <span class="nav-text">使用Server酱发送通知到手机</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#外网访问"><span class="nav-number">3.6.</span> <span class="nav-text">外网访问</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#买云主机"><span class="nav-number">3.6.1.</span> <span class="nav-text">买云主机</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#用frp搭建内网穿透服务"><span class="nav-number">3.6.2.</span> <span class="nav-text">用frp搭建内网穿透服务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#申请域名和证书"><span class="nav-number">3.6.3.</span> <span class="nav-text">申请域名和证书</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#大功告成"><span class="nav-number">4.</span> <span class="nav-text">大功告成</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Tachikoma</p>
  <div class="site-description" itemprop="description">Less is more</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">15</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Tachikoma</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script>



  















  

  

</body>
</html>
